App.Attachment=function(){"use strict";var r,n,o,a=function(){n.length&&$.ajax({url:r,type:"get",dataType:"json"}).done(function(t){n.html(t.html),o.html(t.count)})};return{init:function(t){r=t.url,n=$(t.container),o=$(t.count);var e=$(t.form);e.length&&e.dropzone({init:function(){this.on("success",function(t,e){this.removeFile(t),a()})}});n.length&&n.on("click","a.attachment-delete",function(t){t.preventDefault(),$.ajax({url:this.dataset.url,type:"delete",data:App.csrf}).done(function(){a()})})},show:a}}(),App.Comment=function(){"use strict";var r,n,o,a=function(){n.length&&$.ajax({url:r,type:"get",dataType:"json"}).done(function(t){n.html(t.html),o.html(t.count)})};return{init:function(t){r=t.url,n=$(t.container),o=$(t.count);var e=$(t.form);e.length&&e.submit(function(t){t.preventDefault(),$.ajax({type:e.attr("method"),url:e.attr("action"),data:e.serialize(),dataType:"json"}).done(function(t){e.get(0).reset(),a()})})},show:a}}(),App.initForm=function(t){"use strict";var l=$.extend({},{formId:null,onSuccess:!1,onError:!1},t),e="form";l.formId&&(e=l.formId);var r=document.getElementById(e);if(!r)return!1;var u=$(r);if(!l.onError)var p=$('<div class="alert alert-danger" role="alert"></div>').hide().prependTo(u),d=function(t,e,r,n){var o=e.find('[name="'+r+'"]');void 0!==n&&(o=o.eq(n)),o.length&&(o.parents("div.form-group").addClass("has-error"),o.after('<p class="help-block error-message">'+t+"</p>"))};u.submit(function(t){var e;t.preventDefault();var r="multipart/form-data"==this.enctype;e=r?new FormData(this):u.serialize(),l.onError||p.hide();var c=u.find(":submit");c.prop("disabled",!0),$.ajax({url:this.getAttribute("action"),type:this.getAttribute("method"),data:e,dataType:"json",cache:!r,contentType:!r&&"application/x-www-form-urlencoded; charset=UTF-8",processData:!r}).done(function(t){l.onSuccess?l.onSuccess(t):window.location.replace(t.redirect)}).fail(function(t,e,r){var n="";if(l.onError)l.onError(t,e,r);else{if(400==t.status){var o=t.responseJSON;for(var a in u.find("div.form-group.has-error").removeClass("has-error"),u.find("p.error-message").remove(),o){var i=o[a];if("object"==typeof i)for(var s in i)d(i[s],u,a+"[]",s);else"error"==a?n="<p>"+i+"</p>":d(i,u,a)}}else n="<p>Ocurri√≥ un error al intentar procesar la consulta. Vuelva a intentarlo y, si el problema persiste, pongase en contacto con el administrador.</p>";n&&(p.html(n).show(),p.get(0).scrollIntoView())}c.prop("disabled",!1)})})};